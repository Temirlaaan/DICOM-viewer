{
  "annotations": {
    "list": []
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "collapsed": false,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 0},
      "id": 1,
      "panels": [],
      "title": "Overview",
      "type": "row"
    },
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {
        "defaults": {
          "mappings": [
            {"options": {"0": {"color": "red", "text": "DOWN"}, "1": {"color": "green", "text": "UP"}}, "type": "value"}
          ],
          "thresholds": {"mode": "absolute", "steps": [{"color": "red"}, {"color": "green", "value": 1}]}
        }
      },
      "gridPos": {"h": 4, "w": 4, "x": 0, "y": 1},
      "id": 2,
      "options": {"colorMode": "background", "graphMode": "none", "reduceOptions": {"calcs": ["lastNotNull"]}},
      "targets": [{"expr": "up{job=\"keycloak\"}", "refId": "A"}],
      "title": "Keycloak Status",
      "type": "stat"
    },
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {
        "defaults": {
          "thresholds": {"mode": "absolute", "steps": [{"color": "green"}]},
          "unit": "short"
        }
      },
      "gridPos": {"h": 4, "w": 5, "x": 4, "y": 1},
      "id": 3,
      "options": {"colorMode": "value", "graphMode": "area", "reduceOptions": {"calcs": ["lastNotNull"]}},
      "targets": [{"expr": "sum(increase(keycloak_logins_total[24h]))", "legendFormat": "Logins", "refId": "A"}],
      "title": "Logins (24h)",
      "type": "stat"
    },
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "thresholds"},
          "thresholds": {"mode": "absolute", "steps": [{"color": "green"}, {"color": "yellow", "value": 10}, {"color": "red", "value": 50}]},
          "unit": "short"
        }
      },
      "gridPos": {"h": 4, "w": 5, "x": 9, "y": 1},
      "id": 4,
      "options": {"colorMode": "value", "graphMode": "area", "reduceOptions": {"calcs": ["lastNotNull"]}},
      "targets": [{"expr": "sum(increase(keycloak_login_errors_total[24h]))", "legendFormat": "Failed", "refId": "A"}],
      "title": "Failed Logins (24h)",
      "type": "stat"
    },
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {
        "defaults": {
          "thresholds": {"mode": "absolute", "steps": [{"color": "green"}]},
          "unit": "short"
        }
      },
      "gridPos": {"h": 4, "w": 5, "x": 14, "y": 1},
      "id": 5,
      "options": {"colorMode": "value", "graphMode": "area", "reduceOptions": {"calcs": ["lastNotNull"]}},
      "targets": [{"expr": "keycloak_sessions_active", "legendFormat": "Active Sessions", "refId": "A"}],
      "title": "Active Sessions",
      "type": "stat"
    },
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {
        "defaults": {
          "thresholds": {"mode": "percentage", "steps": [{"color": "green"}, {"color": "yellow", "value": 70}, {"color": "red", "value": 90}]},
          "unit": "percent"
        }
      },
      "gridPos": {"h": 4, "w": 5, "x": 19, "y": 1},
      "id": 6,
      "options": {"colorMode": "value", "graphMode": "area", "reduceOptions": {"calcs": ["lastNotNull"]}},
      "targets": [{"expr": "jvm_memory_used_bytes{job=\"keycloak\",area=\"heap\"} / jvm_memory_max_bytes{job=\"keycloak\",area=\"heap\"} * 100", "legendFormat": "Heap %", "refId": "A"}],
      "title": "JVM Heap Usage",
      "type": "stat"
    },
    {
      "collapsed": false,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 5},
      "id": 7,
      "panels": [],
      "title": "Authentication",
      "type": "row"
    },
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {
        "defaults": {
          "custom": {"drawStyle": "bars", "fillOpacity": 80, "stacking": {"mode": "normal"}},
          "unit": "short"
        },
        "overrides": [
          {"matcher": {"id": "byName", "options": "failures"}, "properties": [{"id": "color", "value": {"fixedColor": "red", "mode": "fixed"}}]},
          {"matcher": {"id": "byName", "options": "success"}, "properties": [{"id": "color", "value": {"fixedColor": "green", "mode": "fixed"}}]}
        ]
      },
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 6},
      "id": 8,
      "options": {"legend": {"calcs": ["sum"], "displayMode": "table", "placement": "bottom"}},
      "targets": [
        {"expr": "increase(keycloak_logins_total[1h])", "legendFormat": "success", "refId": "A"},
        {"expr": "increase(keycloak_login_errors_total[1h])", "legendFormat": "failures", "refId": "B"}
      ],
      "title": "Login Attempts per Hour",
      "type": "timeseries"
    },
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {
        "defaults": {
          "custom": {"drawStyle": "line", "fillOpacity": 10},
          "unit": "short"
        }
      },
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 6},
      "id": 9,
      "options": {"legend": {"displayMode": "table", "placement": "bottom"}},
      "targets": [
        {"expr": "keycloak_sessions_active", "legendFormat": "Active", "refId": "A"},
        {"expr": "keycloak_sessions_offline", "legendFormat": "Offline", "refId": "B"}
      ],
      "title": "Sessions",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 14},
      "id": 10,
      "panels": [],
      "title": "JVM Performance",
      "type": "row"
    },
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {
        "defaults": {
          "custom": {"drawStyle": "line", "fillOpacity": 30},
          "unit": "bytes"
        }
      },
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 15},
      "id": 11,
      "options": {"legend": {"displayMode": "table", "placement": "bottom"}},
      "targets": [
        {"expr": "jvm_memory_used_bytes{job=\"keycloak\",area=\"heap\"}", "legendFormat": "Heap Used", "refId": "A"},
        {"expr": "jvm_memory_max_bytes{job=\"keycloak\",area=\"heap\"}", "legendFormat": "Heap Max", "refId": "B"}
      ],
      "title": "JVM Memory",
      "type": "timeseries"
    },
    {
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "fieldConfig": {
        "defaults": {
          "custom": {"drawStyle": "line", "fillOpacity": 10},
          "unit": "short"
        }
      },
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 15},
      "id": 12,
      "options": {"legend": {"displayMode": "table", "placement": "bottom"}},
      "targets": [
        {"expr": "rate(jvm_gc_collection_seconds_sum{job=\"keycloak\"}[5m])", "legendFormat": "{{ gc }}", "refId": "A"}
      ],
      "title": "GC Time",
      "type": "timeseries"
    }
  ],
  "refresh": "30s",
  "schemaVersion": 39,
  "tags": ["keycloak", "authentication"],
  "time": {"from": "now-24h", "to": "now"},
  "title": "Keycloak Identity Provider",
  "uid": "keycloak-dashboard",
  "version": 1
}

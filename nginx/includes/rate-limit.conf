# =============================================================================
# Rate Limiting Configuration
# =============================================================================

# Zone definitions (must be in http context, included via nginx.conf)
# These limits are per client IP address

# API requests: 100 requests/minute with burst of 50
limit_req_zone $binary_remote_addr zone=api:10m rate=100r/m;

# Login/auth requests: 20 requests/minute with burst of 10
limit_req_zone $binary_remote_addr zone=login:10m rate=20r/m;

# Static assets: 500 requests/minute
limit_req_zone $binary_remote_addr zone=static:10m rate=500r/m;

# DICOM uploads: 30 requests/minute (large files take time)
limit_req_zone $binary_remote_addr zone=upload:10m rate=30r/m;

# Connection limits per IP
limit_conn_zone $binary_remote_addr zone=conn_per_ip:10m;

# Default rate limit status
limit_req_status 429;
limit_conn_status 429;

# Log rate limiting
limit_req_log_level warn;
limit_conn_log_level warn;

# Maximum connections per IP (applied in location blocks)
# limit_conn conn_per_ip 20;
